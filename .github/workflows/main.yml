name: Build Flutter APK

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      # تفحص (Checkout) الكود من المستودع

    - uses: actions/setup-java@v4
      with:
        distribution: 'zulu'
        java-version: '17'
      # تهيئة بيئة Java لبناء Android

    - uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.x.x' # يمكنك تغيير هذا إلى الإصدار المحدد الذي تفضله (مثلاً '3.19.6')
      # تهيئة بيئة Flutter

    - name: Get Flutter dependencies
      run: flutter pub get
      # تثبيت الاعتماديات (dependencies)

    - name: Build Flutter APK
      run: flutter build apk --release
      # تنفيذ أمر البناء (Build) لتوليد ملف APK

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: release-apk
        path: build/app/outputs/flutter-apk/app-release.apk
      # استخدام الإصدار V4 المحدث لـ upload-artifact لرفع ملف APK المنتج
      # هذا الإصدار هو الأحدث ولا يسبب التحذير أو الفشل

# --- إذا كان لديك وظيفة (Job) أخرى تستخدم 'download-artifact'، يجب تحديثها كما يلي: ---
#
#  deploy:
#    runs-on: ubuntu-latest
#    needs: build # يجب أن تعتمد على وظيفة 'build'
#    steps:
#    - name: Download Artifact
#      uses: actions/download-artifact@v4 # **هذا هو التحديث المهم!**
#      with:
#        name: release-apk
#    
#    - name: Deploy to Release/Store (Example)
#      # خطوات النشر الخاصة بك هنا
